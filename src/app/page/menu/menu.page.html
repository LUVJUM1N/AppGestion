<ion-header class="ion-no-border">
    <ion-toolbar class="header-toolbar">
        <ion-title class="main-title">Menú</ion-title>
        <ion-buttons slot="end">
            <!-- Usa ion-avatar con la imagen de perfil -->
            <ion-avatar class="user-avatar" (click)="openProfile()">
                <img [src]="avatarUrl" alt="perfil">
            </ion-avatar>
        </ion-buttons>
    </ion-toolbar>
</ion-header>

<ion-content class="main-content" [fullscreen]="true">
    <div class="content-wrapper">
        <!-- Buscador -->
        <div class="search-bar-container">
            <ion-searchbar placeholder="Buscar" mode="ios" class="custom-searchbar" (ionInput)="onSearchChange($event)"></ion-searchbar>
        </div>

        <!-- Categorías -->
        <div class="categories-section">
            <div class="categories-scroll">
                <div class="category-item" *ngFor="let cat of categories" (click)="selectCategory(cat.title)"
                    [class.active]="cat.title === selectedCategory">
                    <div class="icon-box">
                        <ion-icon [name]="cat.icon"></ion-icon>
                    </div>
                    <span>{{ cat.title }}</span>
                </div>
            </div>
        </div>

        <!-- Sección Personaliza -->
        <div class="customize-section">
            <h2 class="section-title">Personaliza</h2>
            <ion-card class="custom-card" (click)="openCustom()">
                <div class="card-content-wrapper">
                    <p class="subtitle">Crea</p>
                    <h3>PIEZAS A MEDIDA</h3>
                    <p class="description">Define dimensiones, material y tratamientos térmicos.</p>
                </div>
            </ion-card>
        </div>

        <!-- Sección Popular (Filtrado con ion-grid) -->
        <div class="popular-section">
            <h2 class="section-title">Popular</h2>
            <ion-grid class="product-grid">
                <ion-row>
                    <!-- **IMPORTANTE:** Usamos filteredItems para aplicar el filtro de categorías -->
                    <ion-col size="6" *ngFor="let product of filteredItems">


                        <!-- Colocar imágenes del producto -->
                        <!-- AÑADIR RUTA PARA VER DESCRIPCIÓN PRODUCTO -->
                        <ion-card class="product-card" (click)="openProduct(product)">
                            <div class="product-image">
                                <img [src]="product.image" [alt]="product.name" loading="lazy" />
                            </div>
                            <div class="product-info">
                                <p class="product-name">{{ product.name }}</p>
                                <div class="product-actions">
                                    <span class="product-price">S/. {{ product.price }}</span>
                                    <!-- BOTÓN PARA AÑADIR PRODUCTO AL CARRITO -->
                                    <ion-button fill="solid" size="small" class="add-btn"
                                        (click)="addToCart(product); $event.stopPropagation()">
                                        <!-- Usamos add-outline para coincidir con la importación en TS -->
                                        <ion-icon name="add-outline"></ion-icon>
                                    </ion-button>
                                </div>
                            </div>
                        </ion-card>
                    </ion-col>
                </ion-row>

                <!-- Mensaje si no hay resultados -->
                <ion-row *ngIf="filteredItems.length === 0">
                    <ion-col size="12">
                        <div class="no-results">
                            No hay productos populares en la categoría "{{ selectedCategory }}".
                        </div>
                    </ion-col>
                </ion-row>
            </ion-grid>
        </div>
    </div>
</ion-content>

<!-- Navegación Inferior (Footer) -->
<ion-footer class="ion-no-border">
    <ion-toolbar>
        <ion-tab-bar class="bottom-nav">
            <ion-tab-button *ngFor="let item of navItems" [routerLink]="item.route" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
                <ion-icon [name]="item.icon"></ion-icon>
                <!-- Solo mostramos la etiqueta para claridad en el código, pero se oculta por SCSS -->
                <ion-label *ngIf="item.label">{{ item.label }}</ion-label>
                <ion-badge *ngIf="item.badge" color="danger">{{ item.badge }}</ion-badge>
            </ion-tab-button>
        </ion-tab-bar>
    </ion-toolbar>
</ion-footer>